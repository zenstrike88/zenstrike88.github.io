

#<script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/16a48f5d352/bf25108lzj/eb8e96bcb95f32a3_complete.js" crossorigin="anonymous"></script>




<!DOCTYPE html>
<html lang="fr">
<head>
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/16a48f5d352/bf25108lzj/eb8e96bcb95f32a3_complete.js" crossorigin="anonymous"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zen Strike | Geo-Intelligence Dashboard</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* Variables CSS pour un th√®me propre */
        :root {
            --bg-dark: #f8fafc; /* Fond blanc pour la clart√© */
            --panel-bg: #ffffff; /* Panneaux blancs */
            --border-light: #e2e8f0; /* Bordures tr√®s claires */
            --accent: #2563eb; /* Bleu primaire */
            --danger: #ef4444; /* Rouge pour erreurs */
            --warning: #f59e0b; /* Jaune pour alertes */
            --success: #10b981; /* Vert pour succ√®s */
            --text-main: #1f2937; /* Texte sombre */
            --text-muted: #6b7280; /* Texte secondaire */
            --shadow-light: rgba(0,0,0,0.08); /* Ombre l√©g√®re */
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            background: var(--bg-dark); 
            color: var(--text-main); 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
        }

        header { 
            padding: 1rem 2rem; 
            background: var(--panel-bg); 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 2px 10px var(--shadow-light);
            z-index: 1000;
        }

        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; color: var(--text-main); }
        h1 .accent { font-weight: 300; color: var(--accent); }

        #main-container { display: flex; flex: 1; overflow: hidden; }

        #sidebar { 
            width: 380px; /* Un peu plus large pour les infos */
            padding: 1.5rem; 
            background: var(--panel-bg); 
            border-right: 1px solid var(--border-light);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 8px var(--shadow-light);
            flex-shrink: 0; /* Emp√™che le r√©tr√©cissement */
        }

        .section-title {
            color: var(--accent);
            text-transform: uppercase;
            font-size: 0.8rem;
            font-weight: bold;
            margin: 1.5rem 0 1rem;
            display: block;
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 5px;
        }

        #map-container { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
        }

        #map-status-bar {
            height: 30px;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            padding: 0 1rem;
            box-shadow: 0 2px 5px var(--shadow-light);
            z-index: 999;
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        #map-status-bar .status-icon {
            margin-right: 8px;
            font-size: 1.2em;
        }
        #map-status-bar .loading-bar {
            flex-grow: 1;
            height: 4px;
            background-color: var(--border-light);
            border-radius: 2px;
            overflow: hidden;
            margin-left: 1rem;
            display: none; /* Cach√©e par d√©faut */
        }
        #map-status-bar .loading-bar.active { display: block; }
        #map-status-bar .loading-bar-inner {
            width: 0%;
            height: 100%;
            background-color: var(--accent);
            animation: progress-animation 2s infinite linear;
            transition: width 0.3s ease-out;
        }
        @keyframes progress-animation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        #map { flex: 1; background: #eee; } /* Fond clair pour la carte */

        /* Formulaire & Boutons */
        select { 
            width: 100%; 
            padding: 12px; 
            border-radius: 8px; 
            background: #f8fafc; 
            color: var(--text-main); 
            border: 1px solid var(--border-light); 
            margin-bottom: 15px;
            outline: none;
            box-shadow: inset 0 1px 3px var(--shadow-light);
        }
        select:focus { border-color: var(--accent); }

        .btn {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.85rem;
            box-shadow: 0 2px 5px var(--shadow-light);
        }

        .btn-error { background: var(--danger); color: white; }
        .btn-error:hover { background: #b91c1c; transform: translateY(-1px); }

        .btn-warn { background: var(--warning); color: #0f172a; }
        .btn-warn:hover { background: #d97706; transform: translateY(-1px); }

        .btn-info { background: #38bdf8; color: #0f172a; }
        .btn-info:hover { background: #0ea5e9; transform: translateY(-1px); }

        /* Cards & Info */
        .info-card { 
            background: var(--panel-bg); 
            padding: 1.2rem; 
            border-radius: 12px; 
            margin-top: 1rem; 
            border: 1px solid var(--border-light);
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        .info-card strong { color: var(--text-main); font-weight: 600; }
        .info-card small { color: var(--text-muted); font-size: 0.8rem; display: block; margin-bottom: 5px; }
        .info-card p { margin: 0; line-height: 1.6; }
        .info-card ul { list-style: none; padding: 0; margin: 0; }
        .info-card li { margin-bottom: 4px; color: var(--text-main); }
        .info-card .data-value { color: var(--accent); font-weight: 500; }

        .status-online { 
            color: var(--success); 
            font-size: 0.75rem; 
            font-weight: bold; 
            background: rgba(16, 185, 129, 0.1);
            padding: 5px 12px;
            border-radius: 20px;
            border: 1px solid var(--success);
        }
    </style>
</head>
<body>

<header>
    <h1>ZEN STRIKE <span class="accent">GEO-INTELLIGENCE</span></h1>
    <span class="status-online">‚óè DYNATRACE ADVANCED MONITORING</span>
</header>

<div id="main-container">
    <div id="sidebar">
        
        <span class="section-title">Navigation</span>
        <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0;">S√©lectionnez un pays pour explorer ses donn√©es et la carte.</p>
        
        <select id="countrySelect">
            <option value="">-- Choisir un pays --</option>
            <option value="Algeria">Alg√©rie</option>
            <option value="France">France</option>
            <option value="Canada">Canada</option>
            <option value="Japan">Japon</option>
            <option value="Brazil">Br√©sil</option>
        </select>

        <div id="countryDetails" class="info-card" style="display: none;">
            <small>INFORMATIONS CL√âS</small>
            <p><strong>Capitale:</strong> <span id="capitale" class="data-value">-</span></p>
            <p><strong>Population:</strong> <span id="population" class="data-value">-</span></p>
            <p><strong>Monnaie:</strong> <span id="currency" class="data-value">-</span></p>
            <p><strong>Langues:</strong> <span id="languages" class="data-value">-</span></p>
            
            <small style="margin-top: 15px;">VILLES PRINCIPALES</small>
            <ul id="citiesList">
                <li>-</li>
            </ul>
        </div>

        <span class="section-title">Dynatrace Stress Tests</span>
        <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0;">D√©clenchez des sc√©narios pour observer Dynatrace en action.</p>

        <button onclick="triggerJSException()" class="btn btn-error">üî• Trigger JS Crash</button>
        <button onclick="triggerCPUStress()" class="btn btn-warn">üß† Freeze CPU (3s)</button>
        <button onclick="triggerZombieAPI()" class="btn btn-warn">üßü Zombie XHR (Timeout)</button>
        <button onclick="triggerMassivePayload()" class="btn btn-info">üì¶ Heavy Image Load</button>
        <button onclick="trigger404()" class="btn btn-error" style="opacity: 0.8; background: #64748b;">üö´ Broken Asset (404)</button>

        <div id="statusLog" class="info-card">
            <small>CONSOLE LOG / STATUT</small><br>
            <span id="console-status" style="font-size: 0.9rem; color: var(--text-muted);">Pr√™t pour le test...</span>
        </div>
    </div>

    <div id="map-container">
        <div id="map-status-bar">
            <span class="status-icon">üåê</span>
            <span id="map-status-text">Carte interactive</span>
            <div class="loading-bar" id="loadingBar">
                <div class="loading-bar-inner"></div>
            </div>
        </div>
        <div id="map"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Data des villes (l'API REST Countries ne les donne pas directement)
    const countryCities = {
        "Algeria": ["Alger", "Oran", "Constantine"],
        "France": ["Paris", "Marseille", "Lyon"],
        "Canada": ["Toronto", "Montreal", "Vancouver"],
        "Japan": ["Tokyo", "Kyoto", "Osaka"],
        "Brazil": ["Rio de Janeiro", "S√£o Paulo", "Bras√≠lia"]
    };

    // Initialisation de la carte avec un fond clair (CartoDB Positron)
    var map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        maxZoom: 18,
    }).addTo(map);

    const select = document.getElementById('countrySelect');
    const statusLabel = document.getElementById('console-status');
    const mapStatusText = document.getElementById('map-status-text');
    const loadingBar = document.getElementById('loadingBar');
    const countryDetailsCard = document.getElementById('countryDetails');

    let currentMarkers = []; // Pour garder une trace des marqueurs √† supprimer

    // --- FONCTION PRINCIPALE : XHR & CARTE ---
    select.addEventListener('change', async (e) => {
        const country = e.target.value;
        
        // Nettoyer les marqueurs pr√©c√©dents
        currentMarkers.forEach(marker => map.removeLayer(marker));
        currentMarkers = [];

        if (!country) {
            countryDetailsCard.style.display = 'none';
            mapStatusText.innerText = "S√©lectionnez un pays";
            statusLabel.innerText = "Pr√™t pour le test...";
            return;
        }

        statusLabel.innerText = `Recherche de donn√©es pour ${country}...`;
        statusLabel.style.color = var(--text-muted);
        mapStatusText.innerText = `Chargement des donn√©es de ${country}...`;
        loadingBar.classList.add('active'); // Active la barre de chargement

        try {
            const response = await fetch(`https://restcountries.com/v3.1/name/${country}`);
            if (!response.ok) throw new Error("API Error fetching country data");
            
            const data = await response.json();
            const countryData = data[0];

            // Mettre √† jour les d√©tails du pays
            document.getElementById('capitale').innerText = countryData.capital ? countryData.capital[0] : 'N/A';
            document.getElementById('population').innerText = countryData.population ? countryData.population.toLocaleString() : 'N/A';
            document.getElementById('currency').innerText = countryData.currencies ? Object.values(countryData.currencies)[0].name + ' (' + Object.values(countryData.currencies)[0].symbol + ')' : 'N/A';
            document.getElementById('languages').innerText = countryData.languages ? Object.values(countryData.languages).join(', ') : 'N/A';
            
            const citiesList = document.getElementById('citiesList');
            citiesList.innerHTML = '';
            (countryCities[country] || ["N/A"]).forEach(city => {
                const li = document.createElement('li');
                li.innerText = city;
                citiesList.appendChild(li);
            });
            countryDetailsCard.style.display = 'block';

            // Mettre √† jour la carte
            const latlng = countryData.latlng;
            map.flyTo(latlng, 5); // Zoom sur le pays

            // Ajouter un marqueur pour la capitale
            if (countryData.capitalInfo && countryData.capitalInfo.latlng) {
                const capitalLatLng = countryData.capitalInfo.latlng;
                const marker = L.marker(capitalLatLng).addTo(map)
                    .bindPopup(`<b>${countryData.capital[0]}</b><br>Capitale de ${country}`)
                    .openPopup();
                currentMarkers.push(marker);
            }
            
            statusLabel.innerText = `Donn√©es pour ${country} charg√©es.`;
            statusLabel.style.color = var(--success);
            mapStatusText.innerText = `Affichage de ${country}`;

        } catch (error) {
            statusLabel.innerText = `Erreur: ${error.message}`;
            statusLabel.style.color = var(--danger);
            mapStatusText.innerText = `Erreur de chargement: ${error.message.substring(0, 30)}...`;
        } finally {
            loadingBar.classList.remove('active'); // D√©sactive la barre de chargement
        }
    });

    // --- FONCTIONS CHALLENGE DYNATRACE ---

    // 1. FREEZE CPU : Bloque le navigateur (Excellent pour voir les Long Tasks)
    function triggerCPUStress() {
        statusLabel.innerText = "CPU Freeze en cours...";
        statusLabel.style.color = var(--danger);
        const start = Date.now();
        while (Date.now() - start < 3000) { /* Boucle bloquante pendant 3 secondes */ } 
        statusLabel.innerText = "CPU lib√©r√© apr√®s 3s";
        statusLabel.style.color = var(--success);
    }

    // 2. ZOMBIE XHR : Une requ√™te qui ne r√©pondra jamais (Simule une API qui "pend")
    function triggerZombieAPI() {
        statusLabel.innerText = "Appel API Zombie lanc√©...";
        statusLabel.style.color = var(--warning);
        fetch('https://10.255.255.1/timeout_test', { mode: 'no-cors', cache: 'no-store' }) // Utilise no-cors pour √©viter les erreurs CORS pour une IP inexistante
            .then(() => statusLabel.innerText = "API Zombie: Requ√™te bizarrement termin√©e (v√©rifier r√©seau)") // Ne devrait pas arriver
            .catch(err => { 
                statusLabel.innerText = `XHR Timeout d√©tect√©: ${err.message}`;
                statusLabel.style.color = var(--danger);
            });
    }

    // 3. MASSIVE PAYLOAD : Force le t√©l√©chargement d'une image 4K pour plomber le score LCP
    function triggerMassivePayload() {
        statusLabel.innerText = "T√©l√©chargement 4K en cours...";
        statusLabel.style.color = var(--info);
        const img = new Image();
        img.src = "https://upload.wikimedia.org/wikipedia/commons/3/3d/LARGE_ELEVATION.jpg?random=" + Math.random(); // Image haute r√©solution al√©atoire (env. 5-10MB)
        img.onload = () => { 
            statusLabel.innerText = "Image lourde charg√©e"; 
            statusLabel.style.color = var(--success);
        };
        img.onerror = () => {
            statusLabel.innerText = "√âchec chargement image 4K";
            statusLabel.style.color = var(--danger);
        };
    }

    // 4. CRASH JS : G√©n√®re une exception JavaScript non g√©r√©e
    function triggerJSException() {
        statusLabel.innerText = "Exception JS lanc√©e !";
        statusLabel.style.color = var(--danger);
        // Utilise setTimeout pour s'assurer que l'agent Dynatrace ait le temps de capturer l'action avant le crash
        setTimeout(() => {
            throw new Error("Dynatrace Challenge: Critical JS Thread Failure Manually Triggered");
        }, 100); 
    }

    // 5. 404 : Tente de charger une ressource qui n'existe pas
    function trigger404() {
        statusLabel.innerText = "Tentative de ressource 404...";
        statusLabel.style.color = var(--warning);
        fetch('/api/v1/missing_resource_' + Date.now() + '.json').then(r => {
            statusLabel.innerText = `Erreur 404: ${r.statusText} (${r.status})`;
            statusLabel.style.color = var(--danger);
        }).catch(err => {
            statusLabel.innerText = `Erreur r√©seau sur 404: ${err.message}`;
            statusLabel.style.color = var(--danger);
        });
    }
</script>

</body>
</html>
